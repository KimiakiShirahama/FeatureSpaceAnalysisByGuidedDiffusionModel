# FeatureSpaceAnalysisByGuidedDiffusionModel
This is the official implementation of the decoder introduced in the paper "Feature Space Analysis by Guided Diffusion Model" 

One of the key issues in Deep Neural Networks (DNNs) is the black-box nature of their internal feature extraction process. Targeting vision-related domains, this paper focuses on analysing the feature space of a DNN by developing a *decoder* that can generate images whose features are ensured to closely match a user-specified feature. Our decoder is especially implemented as a *guided diffusion model* that guides the reverse image generation of a pre-trained diffusion model to minimise the Euclidean distance between the feature of a clean image estimated at each step and the user-specified one. The main advantage of our decoder is that feature spaces of different DNNs can be analysed with no additional training using a single COTS GPU. The experimental results targeting CLIP's image encoder, ResNet-50 and vision transformer demonstrate that images generated by our decoder have features remarkably similar to the user-specified ones and reveal valuable insights into these DNNs' feature space


## Instllation
Our decoder has been implemented by modifying a [**universal guided diffusion model** developed by A. Bansal *et al.*](https://github.com/arpitbansal297/Universal-Guided-Diffusion) and runs in the same environment as it. This environment can be constructed by the following commands   
```
conda env create -f environment.yaml
conda activate ldm
conda install pytorch torchvision cudatoolkit=11.3 -c pytorch
pip install GPUtil
pip install blobfile
pip install facenet-pytorch
pip install --upgrade transformers huggingface_hub requests
```

To ease the reproduction of our decoder's results, we release Dockerfile to create the same environment as ours. Specifically, our decoder was implemented and tested on Ubuntu 22.04 and CUDA 11.7.1. Also, our anaconda environment was created by [this installer](https://repo.anaconda.com/archive/Anaconda3-2024.06-1-Linux-x86_64.sh).

## High-resolution figures
We had to compress the following figures containing many images due to the file size limitation during the paper preparation. Please click the links below to see the high-resolution versions: 
- [Figure 3](https://xxx)
- [Figure 4](https://xxx)
- [Figure 5](https://xxx)
- [Figure 6](https://xxx)
- [Figure 7](https://xxx)
- [Figure 8](https://xxx)
- [Figure 9](https://doshishaacjp-my.sharepoint.com/:b:/g/personal/kshiraha_mail_doshisha_ac_jp/EYvKeYjCbHBKhtTiUodXJ6QBFYtUzIzsLHFwf66OKCcguA?e=ANYCNB)
- [Figure 11](https://doshishaacjp-my.sharepoint.com/:b:/g/personal/kshiraha_mail_doshisha_ac_jp/EURmEACQRlREp9uJpZkKvL0B6ple-gs-D3UpkXbqOwsHRw)
